= use ansible modules 
Nick Hardiman
:source-highlighter: highlight.js
:revdate: 16-03-2021


ping, yum and unarchive 

== check access to all hosts 

[source,shell]
----
[nick@guest1 0 ~]$ ansible all -m ping
inv_host_1.example.com | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python"
    }, 
... 

    "changed": false, 
    "ping": "pong"
}
[nick@guest1 0 ~]$ 
----


== gather facts  

[source,shell]
----
ansible -m setup localhost
----


== update RPM packages on all hosts 

[source,shell]
----
[nick@guest1 0 ~]$ ansible all -m yum -a 'name=* state=latest'

...(nothing appears for a couple minutes, until the first package update completes)...

 inv_host_1.lab.example.com | CHANGED => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python"
    }, 
    "changed": true, 

...(thousands of lines)...

yum-utils.noarch 0:1.1.31-54.el7_8                                            \n\nReplaced:\n  iwl7265-firmware.noarch 0:22.0.7.0-72.el7  \n\nComplete!\n"
    ]
}
[de
}
[nick@guest1 0 ~]$ 
----


== download and unpack an archive file 

[source,shell]
----
[ansible_user@guest1 0 ~]$  ansible localhost -m unarchive -a "src=https://releases.ansible.com/ansible-tower/setup/ansible-tower-setup-latest.tar.gz dest=. remote_src=yes" --become-user ansible_user
localhost | CHANGED => {
    "changed": true, 
    "dest": ".", 
    "extract_results": {
        "cmd": [
            "/bin/gtar", 
            "--extract", 
            "-C", 
            ".", 
            "-z", 
            "-f", 
            "/home/ansible_user/.ansible/tmp/ansible-tmp-1615890485.37-17973-42595907000571/ansible-tower-setup-latest.tarsoA6JI.gz"
        ], 
        "err": "", 
        "out": "", 
        "rc": 0
    }, 
    "gid": 100, 
    "group": "users", 
    "handler": "TgzArchive", 
    "mode": "0700", 
    "owner": "ansible_user", 
    "secontext": "unconfined_u:object_r:user_home_dir_t:s0", 
    "size": 182, 
    "src": "/home/ansible_user/.ansible/tmp/ansible-tmp-1615890485.37-17973-42595907000571/ansible-tower-setup-latest.tarsoA6JI.gz", 
    "state": "directory", 
    "uid": 1002
}
[ansible_user@guest1 0 ~]$ 
----

